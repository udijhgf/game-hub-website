<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2048 Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #121212;
      color: #ffffff;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
    }
    #board {
      margin: 20px auto;
      width: 320px;
    }
    #board div {
      display: flex;
    }
    #board div div {
      width: 80px;
      height: 80px;
      border: 1px solid #555;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    #score {
      margin: 10px;
    }
    button {
      padding: 8px 16px;
      background: #4caf50;
      border: none;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }
    p a { color: #9fa8da; }
  </style>
</head>
<body>
  <!-- Virtual currency bar -->
  <div id="money-bar" style="text-align:right; margin:10px; font-size:0.9rem; color:#ccc;">
    Balance: $<span id="balance-display">0</span>
  </div>
  <h1>2048</h1>
  <div id="board"></div>
  <p id="score">Score: 0</p>
  <button id="restart">Restart</button>
  <p><a href="index.html">‚Üê Back to Home</a></p>
  <script>
    const size = 4;
    let board = [];
    let score = 0;

    function init() {
      board = [];
      for (let i = 0; i < size; i++) {
        board[i] = [];
        for (let j = 0; j < size; j++) {
          board[i][j] = 0;
        }
      }
      score = 0;
      addRandom();
      addRandom();
      updateUI();
    }

    function addRandom() {
      const empty = [];
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j] === 0) empty.push({ i, j });
        }
      }
      if (empty.length === 0) return;
      const { i, j } = empty[Math.floor(Math.random() * empty.length)];
      board[i][j] = Math.random() < 0.9 ? 2 : 4;
    }

    function slide(row) {
      const arr = row.filter(v => v !== 0);
      while (arr.length < size) arr.push(0);
      return arr;
    }

    function combine(row) {
      for (let i = 0; i < size - 1; i++) {
        if (row[i] !== 0 && row[i] === row[i + 1]) {
          row[i] *= 2;
          score += row[i];
          row[i + 1] = 0;
          i++;
        }
      }
      return row;
    }

    function moveLeft() {
      let moved = false;
      for (let i = 0; i < size; i++) {
        const original = [...board[i]];
        let row = slide(board[i]);
        row = combine(row);
        row = slide(row);
        board[i] = row;
        if (row.toString() !== original.toString()) moved = true;
      }
      if (moved) {
        addRandom();
        updateUI();
        if (isGameOver()) {
          alert('Game over!');
        }
      }
    }

    function moveRight() {
      reverseBoard();
      moveLeft();
      reverseBoard();
    }

    function moveUp() {
      transposeBoard();
      moveLeft();
      transposeBoard();
    }

    function moveDown() {
      transposeBoard();
      moveRight();
      transposeBoard();
    }

    function reverseBoard() {
      for (let i = 0; i < size; i++) {
        board[i].reverse();
      }
    }

    function transposeBoard() {
      const newBoard = [];
      for (let i = 0; i < size; i++) {
        newBoard[i] = [];
        for (let j = 0; j < size; j++) {
          newBoard[i][j] = board[j][i];
        }
      }
      board = newBoard;
    }

    function updateUI() {
      const container = document.getElementById('board');
      container.innerHTML = '';
      document.getElementById('score').textContent = 'Score: ' + score;
      for (let i = 0; i < size; i++) {
        const rowDiv = document.createElement('div');
        for (let j = 0; j < size; j++) {
          const cell = document.createElement('div');
          const val = board[i][j];
          cell.textContent = val === 0 ? '' : val;
          cell.style.background = getColor(val);
          cell.style.color = val <= 4 ? '#776e65' : '#f9f6f2';
          rowDiv.appendChild(cell);
        }
        container.appendChild(rowDiv);
      }
    }

    function getColor(val) {
      switch (val) {
        case 0: return '#2c3e50';
        case 2: return '#eee4da';
        case 4: return '#ede0c8';
        case 8: return '#f2b179';
        case 16: return '#f59563';
        case 32: return '#f67c5f';
        case 64: return '#f65e3b';
        case 128: return '#edcf72';
        case 256: return '#edcc61';
        case 512: return '#edc850';
        case 1024: return '#edc53f';
        case 2048: return '#edc22e';
        default: return '#3c3a32';
      }
    }

    function isGameOver() {
      // Check for any zero
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j] === 0) return false;
        }
      }
      // Check for possible merges
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (j < size - 1 && board[i][j] === board[i][j + 1]) return false;
          if (i < size - 1 && board[i][j] === board[i + 1][j]) return false;
        }
      }
      return true;
    }

    document.addEventListener('keydown', (e) => {
      switch (e.key) {
        case 'ArrowLeft':
          moveLeft();
          break;
        case 'ArrowRight':
          moveRight();
          break;
        case 'ArrowUp':
          moveUp();
          break;
        case 'ArrowDown':
          moveDown();
          break;
      }
    });

    document.getElementById('restart').addEventListener('click', () => {
      init();
    });
    init();
  </script>
  <!-- Shared virtual currency scripts -->
  <script src="money.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      initBalance();
      updateBalanceDisplay();
    });
  </script>
</body>
</html>